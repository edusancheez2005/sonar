(()=>{var e={};e.id=86,e.ids=[86],e.modules={9608:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=9608,e.exports=t},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},1811:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>S,patchFetch:()=>h,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var r={};s.r(r),s.d(r,{GET:()=>l});var a=s(9303),o=s(8716),n=s(670),u=s(7070),i=s(7574);async function l(){if(!process.env.SUPABASE_URL||!process.env.SUPABASE_SERVICE_ROLE)return u.NextResponse.json({error:"Supabase env vars not set"},{status:503});let e=new Date(Date.now()-864e5).toISOString(),{data:t,error:s}=await i.p.from("whale_transactions").select("token_symbol, classification, usd_value, timestamp, from_address").gte("timestamp",e);if(s)return u.NextResponse.json({error:s.message},{status:500});let r=new Map;for(let e of t||[]){let t=e.token_symbol||"â€”",s=r.get(t);s||(s={token:t,buys:0,sells:0,netUsd:0,whales:new Set,lastSeen:null});let a="buy"===(e.classification||"").toLowerCase(),o=Number(e.usd_value||0);a?s.buys+=1:s.sells+=1,s.netUsd+=a?o:-o,s.whales.add(e.from_address||""),(!s.lastSeen||new Date(e.timestamp)>new Date(s.lastSeen))&&(s.lastSeen=e.timestamp),r.set(t,s)}let a=Array.from(r.values()).map(e=>({token:e.token,netUsd:Math.round(e.netUsd),buySellRatio:0===e.sells?e.buys:+(e.buys/e.sells).toFixed(2),uniqueWhales:e.whales.size,lastSeen:e.lastSeen}));return a.sort((e,t)=>Math.abs(t.netUsd)-Math.abs(e.netUsd)),u.NextResponse.json({data:a})}let p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/tokens/leaderboard/route",pathname:"/api/tokens/leaderboard",filename:"route",bundlePath:"app/api/tokens/leaderboard/route"},resolvedPagePath:"/Users/edusanchez/sonar/app/api/tokens/leaderboard/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:m}=p,S="/api/tokens/leaderboard/route";function h(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},7574:(e,t,s)=>{"use strict";s.d(t,{p:()=>r});let r=(0,s(9498).eI)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE,{auth:{persistSession:!1}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,498,972],()=>s(1811));module.exports=r})();