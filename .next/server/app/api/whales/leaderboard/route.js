(()=>{var e={};e.id=917,e.ids=[917],e.modules={9608:e=>{function s(e){var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}s.keys=()=>[],s.resolve=s,s.id=9608,e.exports=s},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},5571:(e,s,t)=>{"use strict";t.r(s),t.d(s,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var r={};t.r(r),t.d(r,{GET:()=>i});var a=t(9303),o=t(8716),n=t(670),l=t(7070),u=t(7574);async function i(){if(!process.env.SUPABASE_URL||!process.env.SUPABASE_SERVICE_ROLE)return l.NextResponse.json({error:"Supabase env vars not set"},{status:503});let e=new Date(Date.now()-864e5).toISOString(),{data:s,error:t}=await u.p.from("whale_transactions").select("from_address, token_symbol, classification, usd_value, timestamp, whale_score").gte("timestamp",e);if(t)return l.NextResponse.json({error:t.message},{status:500});let r=new Map;for(let e of s||[]){let s=e.from_address||"â€”",t=r.get(s);t||(t={address:s,buys:0,sells:0,netUsd:0,tokens:new Set,whale_score:e.whale_score||null,lastSeen:null});let a="buy"===(e.classification||"").toLowerCase(),o=Number(e.usd_value||0);a?t.buys+=1:t.sells+=1,t.netUsd+=a?o:-o,e.token_symbol&&t.tokens.add(e.token_symbol),t.whale_score=Math.max(t.whale_score||0,Number(e.whale_score||0)),(!t.lastSeen||new Date(e.timestamp)>new Date(t.lastSeen))&&(t.lastSeen=e.timestamp),r.set(s,t)}let a=Array.from(r.values()).map(e=>({address:e.address,netUsd:Math.round(e.netUsd),buySellRatio:0===e.sells?e.buys:+(e.buys/e.sells).toFixed(2),tokens:Array.from(e.tokens),whaleScore:e.whale_score||null,lastSeen:e.lastSeen}));return a.sort((e,s)=>Math.abs(s.netUsd)-Math.abs(e.netUsd)),l.NextResponse.json({data:a})}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/whales/leaderboard/route",pathname:"/api/whales/leaderboard",filename:"route",bundlePath:"app/api/whales/leaderboard/route"},resolvedPagePath:"/Users/edusanchez/sonar/app/api/whales/leaderboard/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:m}=d,h="/api/whales/leaderboard/route";function w(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},7574:(e,s,t)=>{"use strict";t.d(s,{p:()=>r});let r=(0,t(9498).eI)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE,{auth:{persistSession:!1}})}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[948,498,972],()=>t(5571));module.exports=r})();